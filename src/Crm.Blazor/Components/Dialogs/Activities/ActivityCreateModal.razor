@using Crm.Employees
@using Crm.Activities
@using Crm.Common
@using Crm.Customers

@inject Microsoft.Extensions.Localization.IStringLocalizer<Crm.Localization.CrmResource> L
@inject IActivityAppService ActivityAppService
@inject IEmployeeAppService EmployeeAppService
@inject ICustomerAppService CustomerAppService

<CascadingValue Value="this">
    <Modal @ref="modalRef">
        <ModalContent Centered>
            <ModalHeader>
                <ModalTitle>@L["Add Activity"]</ModalTitle>
                <CloseButton />
            </ModalHeader>
            <ModalBody>
                <Field>
                    <FieldLabel>@L["Type"]:</FieldLabel>
                    <Select @bind-SelectedValue="Types">
                        @foreach (var type in Enum.GetValues(typeof(EnumType)).Cast<EnumType>())
                        {
                            <SelectItem Value="@type">@type</SelectItem>
                        }
                    </Select>
                </Field>                
                <Field>
                    <FieldLabel>@L["Description"]:</FieldLabel>
                    <InputText @bind-Value="Description" class="form-control" />
                </Field>
                <Card>
                    <Field>
                        <FieldLabel>
                            @L["Activity Date"]:</FieldLabel>
                        <DatePicker TValue="DateTime?" InputMode="DateInputMode.DateTime" @bind-Date="ActivityDate" Format="yyyy-MM-dd HH:mm" />
                    </Field>
                </Card>                                         

                <Field>
                    <FieldLabel>
                        @L["Employees"]:</FieldLabel>
                    <Select TValue="Guid" @bind-SelectedValue="SelectedEmployeeId">
                        <SelectItem Value="Guid.Empty">@L["Select"]</SelectItem>
                        @foreach (var employee in Employees)
                        {
                            <SelectItem Value="@employee.Id">@employee.FirstName</SelectItem>
                        }
                    </Select>
                </Field>
                <Field>
                    <FieldLabel>
                        @L["Customer"]:</FieldLabel>
                    <Select TValue="Guid" @bind-SelectedValue="@SelectedCustomerId">
                        <SelectItem Value="Guid.Empty">
                            @L["Select"]</SelectItem>
                        @foreach (var customer in Customers)
                        {
                            <SelectItem Value="@customer.Id">@customer.Name</SelectItem>
                        }
                    </Select>
                </Field>
            </ModalBody>
            <ModalFooter>
                <Button Color="Color.Danger" Clicked="@HideModal">
                    @L["Close"]</Button>
                <Button Color="Color.Success" Clicked="@CreateActivityAsync">@L["Save Changes"]</Button>
            </ModalFooter>
        </ModalContent>
    </Modal>
</CascadingValue>

