@using Crm.Employees
@using Crm.Projects
@using Crm.Common
@using Crm.Customers
@using Blazorise
@using Blazorise.Components

@inject IProjectAppService ProjectAppService
@inject IEmployeeAppService EmployeeAppService
@inject ICustomerAppService CustomerAppService
@inject IProjectEmployeeAppService ProjectEmployeeAppService
@inject Microsoft.Extensions.Localization.IStringLocalizer<Crm.Localization.CrmResource> L

<CascadingValue Value="this">
    <Modal @ref="modalRef">
        <ModalContent Centered>

            <ModalHeader>
                <ModalTitle>@L["Add Project"]</ModalTitle>
                <CloseButton />
            </ModalHeader>

            <ModalBody>
                <Validations @ref="validations" Mode="ValidationMode.Manual" Model="ProjectCreateDto">
                
                    <!-- Name -->
                    <Validation>
                        <Field>
                            <FieldLabel>@L["Project Name"]:</FieldLabel>
                            <FieldBody>
                                <TextEdit @bind-Text="ProjectCreateDto.Name">
                                <Feedback>
                                        <ValidationError>@L["Required"]</ValidationError>
                                    </Feedback>
                                    </TextEdit>
                            </FieldBody>                            
                        </Field>
                    </Validation>

                    <!-- Description -->
                    <Validation>
                        <Field>
                            <FieldLabel>@L["Description"]:</FieldLabel>
                            <FieldBody>
                                <TextEdit @bind-Text="ProjectCreateDto.Description">
                                    <Feedback>
                                        <ValidationError>@L["Required"]</ValidationError>
                                    </Feedback>
                                </TextEdit>
                            </FieldBody>
                        </Field>
                    </Validation>

                    <!-- Start Time -->
                <Card>
                    <Field>
                        <FieldLabel>@L["Start Time"]:</FieldLabel>
                        <DatePicker TValue="DateTime?" InputMode="DateInputMode.Date" @bind-Date="ProjectCreateDto.StartTime"  />
                    </Field>
                </Card>
                    
                <!-- End Time -->
                        <Card>
                            <Field>
                                <FieldLabel>@L["End Time"]:</FieldLabel>
                                <FieldBody>
                                    <DatePicker TValue="DateTime?" InputMode="DateInputMode.Date" @bind-Date="ProjectCreateDto.EndTime" />                                                              
                                </FieldBody>
                            </Field>
                        </Card>

                <!-- Status -->
                <Field>
                    <FieldLabel>@L["Status"]:</FieldLabel>
                    <Select @bind-SelectedValue="Status">
                        @foreach (var status in Enum.GetValues(typeof(EnumStatus)).Cast<EnumStatus>())
                        {
                            <SelectItem Value="@status">@status</SelectItem>
                        }
                    </Select>
                </Field>

                    <!-- Revenue -->
                    <Validation Validator="ValidateRevenue"> 
                        <Field>
                            <FieldLabel>@L["Revenue"]:</FieldLabel>
                            <FieldBody>
                                <NumericEdit TValue="decimal"
                                             @bind-Value="Revenue"
                                             class="form-control"/>
                                <ValidationError />
                            </FieldBody>
                            <ValidationError>
                                @L["Revenue must be greater than 0"]
                            </ValidationError>
                        </Field>
                    </Validation>
                    

                    <!-- Success Rate -->
                    <Validation Validator="ValidateSuccesRate"> 
                    <Field>
                        <FieldLabel>@L["Succes Rate"]:</FieldLabel>
                        <FieldBody>
                            <NumericEdit TValue="decimal"
                                         @bind-Value="SuccesRate"
                                         class="form-control"
                                         Validator="ValidateSuccesRate" />                            
                        </FieldBody>
                            <ValidationError>
                                @L["Success Rate must be greater than 0"]
                            </ValidationError> 
                    </Field>
                   </Validation> 
                
                <!-- Employee -->
                <Validation Validator="ValidateEmployee"> 
                        <Field>
                            <FieldLabel>@L["Employees"]:</FieldLabel>
                            <FieldBody>
                                <Select TValue="Guid" Multiple="true" SelectedValues="SelectedEmployeeIds"
                                        SelectedValuesChanged="@(v => SelectedEmployeeIds = v.ToList())">
                                    @foreach (var employee in Employees)
                                    {
                                        <SelectItem Value="@employee.Id">@employee.FirstName @employee.LastName</SelectItem>
                                    }
                                </Select>

                                <ValidationError>
                                    @L["Employee is required"]
                                </ValidationError> 
                            </FieldBody>                            
                        </Field>
                    </Validation> 

                <!-- Customer -->
               <Validation Validator="ValidateCustomer"> 
                        <Field>
                            <FieldLabel>@L["Customer"]:</FieldLabel>
                            <FieldBody>
                                <Select TValue="Guid" @bind-SelectedValue="@SelectedCustomerId">
                                    <SelectItem Value="Guid.Empty">Seçiniz</SelectItem>
                                    @foreach (var customer in Customers)
                                    {
                                        <SelectItem Value="@customer.Id">@($"{customer.FullName}")</SelectItem>

                                    }
                                </Select>

                                <ValidationError>
                                    @L["Customer is required"]
                                </ValidationError> 
                            </FieldBody>                            
                        </Field>
                   </Validation> 

                </Validations>
            </ModalBody>

            <ModalFooter>
                <Button Color="Color.Secondary" Clicked="@HideModal">@L["Close"]</Button>
                <Button Color="Color.Primary" Clicked="@CreateProjectAsync">@L["Save Changes"]</Button>
            </ModalFooter>

        </ModalContent>
    </Modal>
</CascadingValue>

