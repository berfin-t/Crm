@using Crm.Employees
@using Crm.Positions
@using Crm.Common

@inject IPositionAppService PositionAppService
@inject IEmployeeAppService EmployeeAppService
@inject Microsoft.Extensions.Localization.IStringLocalizer<Crm.Localization.CrmResource> L

<CascadingValue Value="this">
    <Modal @ref="modalRef">
        <ModalContent Centered>

            <ModalHeader>
                <ModalTitle>@L["Add Employee"]</ModalTitle>
                <CloseButton />
            </ModalHeader>

            <ModalBody>
                <Validations @ref="validations"
                             Mode="ValidationMode.Manual"
                             Model="EmployeeCreateDto">

                    <!-- First Name -->
                    <Validation>
                        <Field>
                            <FieldLabel>@L["First Name"]</FieldLabel>
                            <FieldBody>
                                <TextEdit @bind-Text="EmployeeCreateDto.FirstName" />
                                <ValidationError>@L["Required"]</ValidationError>
                            </FieldBody>
                        </Field>
                    </Validation>

                    <!-- Last Name -->
                    <Validation>
                        <Field>
                            <FieldLabel>@L["Last Name"]</FieldLabel>
                            <FieldBody>
                                <TextEdit @bind-Text="EmployeeCreateDto.LastName" />
                                <ValidationError>@L["Required"]</ValidationError>
                            </FieldBody>
                        </Field>
                    </Validation>

                    <!-- Email -->
                    <Validation>
                        <Field>
                            <FieldLabel>@L["Email"]</FieldLabel>
                            <FieldBody>
                                <TextEdit @bind-Text="EmployeeCreateDto.Email" />
                                <ValidationError>
                                    @L["Required"], @L["Invalid email address"]
                                </ValidationError>
                            </FieldBody>
                        </Field>
                    </Validation>

                    <!-- Phone -->
                    <Validation>
                        <Field>
                            <FieldLabel>@L["Phone number"]</FieldLabel>
                            <FieldBody>
                                <TextEdit @bind-Text="EmployeeCreateDto.PhoneNumber" />
                                <ValidationError>@L["Required"]</ValidationError>
                            </FieldBody>
                        </Field>
                    </Validation>

                    <!-- Address -->
                    <Validation>
                        <Field>
                            <FieldLabel>@L["Address"]</FieldLabel>
                            <FieldBody>
                                <TextEdit @bind-Text="EmployeeCreateDto.Address" />
                                <ValidationError>@L["Required"]</ValidationError>
                            </FieldBody>
                        </Field>
                    </Validation>

                    <!-- Birth Date -->
                    <Field>
                        <FieldLabel>@L["Birth Date"]</FieldLabel>
                        <DatePicker @bind-Date="EmployeeCreateDto.BirthDate"
                                    Format="yyyy-MM-dd" />
                    </Field>

                    <!-- Position -->
                    <Validation Validator="ValidatePosition">
                        <Field>
                            <FieldLabel>@L["Position"]</FieldLabel>
                            <FieldBody>
                                <Select TValue="Guid"
                                        @bind-SelectedValue="EmployeeCreateDto.PositionId">
                                    <SelectItem Value="Guid.Empty">@L["Select"]</SelectItem>
                                    @foreach (var position in Positions)
                                    {
                                        <SelectItem Value="@position.Id">
                                            @position.Name
                                        </SelectItem>
                                    }
                                </Select>

                                <ValidationError>
                                    @L["Position is required"]
                                </ValidationError>
                            </FieldBody>
                        </Field>
                    </Validation>

                    <!-- Photo -->
                    <Field>
                        <FieldLabel>@L["Photo"]</FieldLabel>
                        <InputFile OnChange="HandleFileSelected" accept="image/*" />

                        @if (!string.IsNullOrEmpty(EmployeeCreateDto.PhotoPath))
                        {
                            <img src="@EmployeeCreateDto.PhotoPath"
                                 style="width:120px;height:120px;margin-top:10px;border-radius:10px;" />
                        }
                    </Field>

                    <!-- Gender -->
                    <Field>
                        <FieldLabel>@L["Gender"]</FieldLabel>
                        <Select @bind-SelectedValue="EmployeeCreateDto.Gender">
                            @foreach (var gender in Enum.GetValues(typeof(EnumGender)).Cast<EnumGender>())
                            {
                                <SelectItem Value="@gender">@gender</SelectItem>
                            }
                        </Select>
                    </Field>

                </Validations>
            </ModalBody>

            <ModalFooter>
                <Button Color="Color.Secondary" Clicked="HideModal">
                    @L["Close"]
                </Button>

                <Button Color="Color.Primary" Clicked="CreateEmployeeAsync">
                    @L["Save"]
                </Button>
            </ModalFooter>

        </ModalContent>
    </Modal>
</CascadingValue>
