@page "/activities"

@using Blazorise
@using Crm.Activities
@using Crm.Blazor.Components.Dialogs.Activities

@inject IActivityAppService ActivityAppService

<Container>
    <h3 class="text-center">Timeline</h3>
    <div class="timeline">
        @for (int i = 0; i < activityList.Count; i++)
        {
            var activity = activityList[i];
            var isLeft = i % 2 == 0;
            <div class="timeline-item @(isLeft ? "left" : "right")">
                <div class="timeline-date">@activity.Date.ToString("dd")<br>@activity.Date.ToString("MMM")</div>
                <div class="timeline-content">
                    <h5 style="font-weight: bold; font-size: 16px; display: flex; justify-content: space-between;">
                        <span style="color: black">@activity.Type</span>
                        <span style="color: dodgerblue">@activity.Date.ToString("HH:mm")</span>
                    </h5>
                    <p>@activity.Description</p>
                    <Button Color="Color.Primary" Clicked="@(() => ShowEditModal(activity))">Read more</Button>
                </div>
            </div>
        }
    </div>
</Container>

<style>
    .timeline {
        position: relative;
        width: 60%;
        margin: auto;
        padding: 20px 0;
    }

        .timeline::after {
            content: '';
            position: absolute;
            width: 4px;
            background-color: #007bff;
            top: 0;
            bottom: 0;
            left: 50%;
            margin-left: -2px;
        }

    .timeline-item {
        display: flex;
        align-items: center;
        position: relative;
        width: 50%;
        padding: 20px;
    }

        .timeline-item.left {
            justify-content: flex-end;
            text-align: right;
            left: 0;
        }

        .timeline-item.right {
            left: 50%;
        }

    .timeline-date {
        background: #007bff;
        color: white;
        padding: 10px;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        position: absolute;
        top: 20px;
    }

    .timeline-item.left .timeline-date {
        right: -80px;
    }

    .timeline-item.right .timeline-date {
        left: -80px;
    }

    .timeline-content {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        width: 80%;
    }
</style>

@code {
    private List<ActivityDto> activityList = new();
    private ActivityDto selectedActivity;
    private ActivityEditModal activityEditModal;

    protected override async Task OnInitializedAsync()
    {
        activityList = await ActivityAppService.GetListAllAsync();
        if (activityList != null)
        {
            activityList = activityList;
        }
    }

    private async Task ShowEditModal(ActivityDto activity)
    {
        if (activityEditModal != null)
        {
            await activityEditModal.ShowModal(activity);
        }
    }
}
