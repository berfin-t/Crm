@page "/employees"

@using Blazorise.Components
@using Crm.Employees
@using Crm.Common
@using Crm.Blazor.Components
@using Crm.Positions

@inject NavigationManager Navigation
@inject IEmployeeAppService EmployeeAppService
@inject IPositionAppService PositionAppService

<Div Margin="Margin.IsAuto.OnX">
    <Card>
        <CardBody Flex="Flex.JustifyContent.Between.AlignItems.Center">
            <Div>
                <Field Display="Display.InlineFlex" Margin="Margin.Is0.FromBottom">
                    
                    <Autocomplete TItem="EmployeeDto"
                                  TValue="string"
                                  Data="@ReadDataEmployees"
                                  ReadData="@OnHandleReadData"
                                  TextField="@(( item ) => item.FirstName)"
                                  ValueField="@((item) => item.Id.ToString())"
                                  @bind-SelectedText="selectedAutoCompleteText"
                                  @onkeydown="@OnEntered"
                                  Placeholder="Search..."
                                  FreeTyping>
                        <NotFoundContent> Sorry... @context was not found! :( </NotFoundContent>
                    </Autocomplete>                    
                </Field>
            </Div>
            <Div Flex="Flex.JustifyContent.Between.AlignItems.Center" Gap="Gap.Is3">

                <Field Display="Display.InlineFlex" Margin="Margin.Is0.FromBottom">
                    <Button Color="Color.Success" Clicked="@ShowCreateModal">Add Employee</Button>
                </Field>               

            </Div>
        </CardBody>
    </Card>
</Div>

<Row>
    @foreach (var employee in FilteredEmployees)
    {
        <Column ColumnSize="ColumnSize.Is4.OnWidescreen.Is8.OnDesktop.Is10.OnTablet">
            <Card>
                <CardBody>
                    <Div style="position: relative;" class="employee-card-container">
                        <Div class="employee-card-dropdown-toggle">
                            <Button @onclick="() => ToggleDropdown(employee.Id)" class="dropdown-button">
                                &#8942;
                            </Button>

                            @if (ActiveDropdownEmployeeId == employee.Id)
                            {
                                <Div class="employee-dropdown-menu">
                                    <Button @onclick="() => OnSelectEmployeeForEdit(employee)" class="dropdown-item">
                                        Edit
                                    </Button>
                                    <Button @onclick="() => OnSelectEmployeeForDelete(employee)" class="dropdown-item">
                                        Delete
                                    </Button>
                                </Div>
                            }
                        </Div>

                        <!-- Content Centered -->
                        <Div class="employee-info">
                            <img src="@employee.PhotoPath" alt="Profile Photo" class="employee-photo" />
                            <Span class="employee-name">@employee.FullName</Span>
                            <br />
                            <Span>@PositionList.FirstOrDefault(p => p.Id == employee.PositionId)?.Name</Span>
                            <br />
                            <a href="mailto:@employee.Email" class="employee-email">@employee.Email</a>
                            <Span class="employee-phone">@employee.PhoneNumber</Span>
                        </Div>
                    </Div>
                </CardBody>
            </Card>
        </Column>
    }
</Row>

@* <Div Flex="Flex.JustifyContent.Center">
    <Button Color="Color.Light" @onclick="LoadMoreEmployees">Load More</Button>
</Div> *@

@* ********** Employee DELETE MODAl ********** *@
<Modal @bind-Visible="isDeleteModalVisible" Size="ModalSize.Small" BackdropClick="true">
    <ModalContent>
        <ModalHeader>
            <ModalTitle>Onayla</ModalTitle>
            <Button CloseButton @onclick="() => isDeleteModalVisible = false" />
        </ModalHeader>
        <ModalBody>
            Silmek istediğinize emin misiniz?
        </ModalBody>
        <ModalFooter>
            <Button Color="Color.Danger" @onclick="ConfirmDelete">Sil</Button>
            <Button Color="Color.Secondary" @onclick="() => isDeleteModalVisible = false">İptal</Button>
        </ModalFooter>
    </ModalContent>
</Modal>


@* ********** CREATE MODAL ********** *@
<Crm.Blazor.Components.Dialogs.Employees.EmployeeCreateModal @ref="employeeCreateModal" />

@* ********** EDIT MODAL ********** *@
<Crm.Blazor.Components.Dialogs.Employees.EmployeeEditModal @ref="employeeEditModal" />